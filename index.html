<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Work Hours & Earnings Tracker</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f6f9;
      margin: 0; padding: 20px; color: #333;
    }
    h2, h3 { text-align: center; margin: 0 0 20px; }
    form {
      background: #fff; padding: 20px; border-radius: 8px;
      max-width: 900px; margin: auto 0 30px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .form-row {
      display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;
    }
    .form-row label {
      flex: 1 1 200px; min-width: 150px;
    }
    input, textarea, button, select {
      width: 100%; padding: 8px; font-size: 1rem;
      border: 1px solid #ccc; border-radius: 4px;
    }
    textarea { resize: vertical; height: 50px; }
    button {
      background: #4a90e2; color: #fff; border: none;
      padding: 10px 15px; cursor: pointer; border-radius: 4px;
      margin-right: 10px;
    }
    button:hover { background: #357ab8; }
    .day-block {
      border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px;
    }
    .day-block h4 { margin: 10px 0 5px; }
    #weekTable { max-width: 900px; margin: auto; }
    table {
      width: 100%; border-collapse: collapse;
      margin-bottom: 30px; background: #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 8px; border: 1px solid #ddd; text-align: center;
      font-size: 0.9rem;
    }
    th { background: #f0f0f0; }
    tr:nth-child(even) { background: #f9f9f9; }
    .subtotal { background: #eaf2fb; font-weight: bold; }
    .grand { background: #d0e5f7; font-weight: bold; }
    .actions button { margin: 0 3px; padding: 5px 8px; font-size: 0.8rem; }
  </style>
</head>
<body>

<h2>Work Hours & Earnings Tracker</h2>

<form id="workForm">
  <div class="form-row">
    <label>Week Date Range:<input type="text" id="weekRange" placeholder="e.g. May 1 â€“ May 7" required></label>
    <label>Hourly Rate ($):<input type="number" id="hourlyRate" step="0.01" required></label>
    <label>Breaks (hrs/week):<input type="number" id="breaks" step="0.1" value="0"></label>
  </div>

  <div id="daysContainer">
    <script>
      const dayNames = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
      dayNames.forEach((d,i) => {
        document.write(`
          <div class="day-block">
            <h4>${d}</h4>
            <div class="form-row">
              <label>Hours:<input type="number" id="${d}_hrs" step="0.01"></label>
              <label>Co-worker:<input type="text" id="${d}_cow"></label>
              <label>Note:<input type="text" id="${d}_note"></label>
            </div>
          </div>
        `);
      });
    </script>
  </div>

  <div class="form-row">
    <button type="button" id="submitBtn" onclick="saveWeek()">Add Week</button>
    <button type="button" onclick="clearAll()">Clear All</button>
    <button type="button" onclick="exportCSV()">Export CSV</button>
  </div>
</form>

<div id="weekTable"></div>

<script>
  let allWeeks = JSON.parse(localStorage.getItem('workLog')||'[]');
  let editIndex = -1;

  function saveWeek(){
    const range = weekRange.value.trim();
    const rate = parseFloat(hourlyRate.value);
    const br = parseFloat(breaks.value)||0;
    if(!range||!rate){ return alert("Please fill date range & rate."); }
    // collect days
    let total=0, daily=[];
    dayNames.forEach(d=>{
      const h= parseFloat(document.getElementById(d+'_hrs').value)||0;
      const c= document.getElementById(d+'_cow').value.trim();
      const n= document.getElementById(d+'_note').value.trim();
      total+=h;
      daily.push({h,c,n});
    });
    const worked = Math.max(0,total-br);
    const reg = Math.min(40,worked), ot=Math.max(0,worked-40);
    const regPay=reg*rate, otPay=ot*rate*1.5, totPay=regPay+otPay;
    const entry = {range,rate,br,daily,worked,reg,ot,regPay,otPay,totPay};
    if(editIndex>=0){
      allWeeks[editIndex]=entry;
    } else allWeeks.push(entry);
    localStorage.workLog=JSON.stringify(allWeeks);
    resetForm(); renderTable();
  }

  function editWeek(i){
    editIndex=i; const w=allWeeks[i];
    weekRange.value=w.range; hourlyRate.value=w.rate; breaks.value=w.br;
    w.daily.forEach((d,i)=>{ 
      const day=dayNames[i];
      document.getElementById(day+'_hrs').value=d.h;
      document.getElementById(day+'_cow').value=d.c;
      document.getElementById(day+'_note').value=d.n;
    });
    submitBtn.textContent="Update Week";
  }

  function deleteWeek(i){
    if(confirm("Delete this week?")){ allWeeks.splice(i,1);
      localStorage.workLog=JSON.stringify(allWeeks);
      renderTable();
    }
  }

  function resetForm(){
    editIndex=-1; submitBtn.textContent="Add Week";
    workForm.reset();
  }

  function clearAll(){
    if(confirm("Clear all data?")){
      allWeeks=[]; localStorage.removeItem('workLog');
      renderTable();
    }
  }

  function renderTable(){
    if(!allWeeks.length){
      weekTable.innerHTML='';
      return;
    }
    let html=`<h3>Weekly Logs</h3>`;
    let grand={worked:0,reg:0,ot:0,regPay:0,otPay:0,totPay:0};
    // group by 2
    for(let i=0;i<allWeeks.length;i+=2){
      const block=allWeeks.slice(i,i+2);
      html+=`<table><tr>
        <th>Wk</th><th>Range</th>${dayNames.map(d=>`<th>${d.slice(0,3)}</th>`).join('')}
        <th>Br</th><th>Work</th><th>Reg</th><th>OT</th><th>Reg$</th><th>OT$</th><th>Total$</th><th>Actions</th>
      </tr>`;
      let sub={worked:0,reg:0,ot:0,regPay:0,otPay:0,totPay:0};
      block.forEach((w,idx)=>{
        html+=`<tr>
          <td>${i+idx+1}</td><td>${w.range}</td>
          ${w.daily.map(d=>`<td>${d.h.toFixed(2)}<br><small>${d.c}</small><br><em>${d.n}</em></td>`).join('')}
          <td>${w.br.toFixed(2)}</td>
          <td>${w.worked.toFixed(2)}</td>
          <td>${w.reg.toFixed(2)}</td>
          <td>${w.ot.toFixed(2)}</td>
          <td>${w.regPay.toFixed(2)}</td>
          <td>${w.otPay.toFixed(2)}</td>
          <td>${w.totPay.toFixed(2)}</td>
          <td class="actions">
            <button onclick="editWeek(${i+idx})">Edit</button>
            <button onclick="deleteWeek(${i+idx})">Del</button>
          </td>
        </tr>`;
        ['worked','reg','ot','regPay','otPay','totPay'].forEach(k=>sub[k]+=w[k]);
      });
      html+=`<tr class="subtotal">
        <td colspan="2">Subtotal</td>
        ${Array(7).fill('<td></td>').join('')}
        <td></td>
        <td>${sub.worked.toFixed(2)}</td><td>${sub.reg.toFixed(2)}</td>
        <td>${sub.ot.toFixed(2)}</td><td>${sub.regPay.toFixed(2)}</td>
        <td>${sub.otPay.toFixed(2)}</td><td>${sub.totPay.toFixed(2)}</td>
        <td></td>
      </tr></table>`;
      Object.keys(grand).forEach(k=>grand[k]+=sub[k]);
    }
    // grand total
    html+=`<table><tr class="grand">
      <td colspan="2">Grand Total</td>
      ${Array(7).fill('<td></td>').join('')}
      <td></td>
      <td>${grand.worked.toFixed(2)}</td><td>${grand.reg.toFixed(2)}</td>
      <td>${grand.ot.toFixed(2)}</td><td>${grand.regPay.toFixed(2)}</td>
      <td>${grand.otPay.toFixed(2)}</td><td>${grand.totPay.toFixed(2)}</td><td></td>
    </tr></table>`;
    weekTable.innerHTML=html;
  }

  function exportCSV(){
    if(!allWeeks.length) return alert("No data");
    let csv = ['Week,Range,' +
      dayNames.map(d=>d.slice(0,3)).join(',') +
      ',Br,Work,Reg,OT,Reg$,OT$,Total$'].join('')+'\n';
    allWeeks.forEach((w,i)=>{
      csv+=[
        i+1,`"${w.range}"`,
        ...w.daily.map(d=>d.h.toFixed(2)),
        w.br.toFixed(2),
        w.worked.toFixed(2),
        w.reg.toFixed(2),
        w.ot.toFixed(2),
        w.regPay.toFixed(2),
        w.otPay.toFixed(2),
        w.totPay.toFixed(2)
      ].join(',')+'\n';
    });
    const blob=new Blob([csv],{type:'text/csv'});
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download='work_hours.csv';
    a.click();
  }

  renderTable();
</script>

</body>
</html>
